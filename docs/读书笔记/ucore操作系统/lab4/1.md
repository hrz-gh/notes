#### 练习1：分配并初始化一个进程控制块

在kern/process/proc.c中完成alloc\_proc()函数。代码为：

```c
   proc->state = PROC_UNINIT;
   proc->pid = -1;
   proc->runs = 0;
   proc->kstack = 0;
   proc->need_resched = 0;
   proc->parent = NULL;
   proc->mm = NULL;
   memset(&(proc->context), 0, sizeof(struct context));
   proc->tf = NULL;
   proc->cr3 = boot_cr3;
   proc->flags = 0;
   memset(proc->name, 0, PROC_NAME_LEN);
```

该函数主要对state/pid/runs/kstack/need\_resched/parent/mm/context/tf/cr3/flags/name等变量进行初始化操作。

**问题1.1：请说明proc\_struct中struct context context和struct trapframe *tf成员变量含义和在本实验中的作用是？**

context作用时在进行上下文切换的过程中，保存当前寄存器的值。其定义在kern/process/proc.h中：

```c
struct context {
    uint32_t eip;
    uint32_t esp;
    uint32_t ebx;
    uint32_t ecx;
    uint32_t edx;
    uint32_t esi;
    uint32_t edi;
    uint32_t ebp;
};
```

trapframe *tf用于记录发生中断之前的栈帧的内容，其中一部分为硬件保存。定义在kern/trap/trap.h中：

```c
struct trapframe {
    struct pushregs tf_regs;
    uint16_t tf_gs;
    uint16_t tf_padding0;
    uint16_t tf_fs;
    uint16_t tf_padding1;
    uint16_t tf_es;
    uint16_t tf_padding2;
    uint16_t tf_ds;
    uint16_t tf_padding3;
    uint32_t tf_trapno;
    /* below here defined by x86 hardware */
    uint32_t tf_err;
    uintptr_t tf_eip;
    uint16_t tf_cs;
    uint16_t tf_padding4;
    uint32_t tf_eflags;
    /* below here only when crossing rings, such as from user to kernel */
    uintptr_t tf_esp;
    uint16_t tf_ss;
    uint16_t tf_padding5;
} __attribute__((packed));
```

